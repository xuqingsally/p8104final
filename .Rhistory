setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
names(df)
df<-df[J(unique(patientid)), mult = "first"] %>%
select(-loshours,-admitdtm,-postalcode,-facilityname,-facilityzip,-n)
plot(df)
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
#count number of visit
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
data.table()
#select first visit
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
table(df$gender)
table(df$race)
table(df$religion)
table(df$maritalstatus)
table(df$insurancetype)
summary(df)
tem<-df %>%
filter(temperature<35)
View(tem)
tem<-df %>%
replace(temperature<15, NA)
tem<-df %>%
replace(df$temperature<15, NA)
df[df$temperature < 15] <- NA
summary(df)
filter(df$respirationrate>50)
filter(df,df$respirationrate>50)
names(df)
lm<-(losday2~factor(is30dayreadmit),data=df)
lm<-(losday2~mews,data=df)
lm<-(losday2~mews,data=df)
library(MASS)
lm<-(losday2~mews,data=df)
lm<-(df$losday2~df$mews)
summary(lm)
lm<-lm(losday2~mews,data=df)
summary(lm)
lm(losday2~mews,data=df)
names(df)
lm<-lm(losdays2~mews,data=df)
summary(lm)
lm(losdays2~mews,data=df)
lm1<-lm(losdays2~factor(is30dayreadmit),data=df)
lm2<-lm(losdays2~mews,data=df)
lm3<-lm(losdays2~cindex,data=df)
lm4<-lm(losdays2~evisit,data=df)
lm5<-lm(losdays2~ageyear,data=df)
lm6<-lm(losdays2~factor(gender),data=df)
lm7<-lm(losdays2~factor(race),data=df)
lm8<-lm(losdays2~factor(religion),data=df)
lm9<-lm(losdays2~factor(maritalstatus),data=df)
lm10<-lm(losdays2~factor(insurancetype),data=df)
summary(lm1)
summary(lm2)
summary(lm3)
summary(lm4)
summary(lm5)
summary(lm6)
summary(lm7)
summary(lm8)
summary(lm9)
summary(lm10)
lm11<-lm(losdays2~bmi+bpsystolic+o2sat+temperature+heartrate+respirationrate+bpdiastolic,data=df)
summary(lm11)
lm12<-lm(losdays2~bmi+bpsystolic+o2sat+temperature+heartrate+respirationrate+bpdiastolic+mews,data=df)
summary(lm12)
vif(lm12)
library(MASS)
vif(lm12)
??vif
install.packages("HH")
library(HH)
vif(lm12)
vif(lm11)
lm13<-lm(losdays2~bmi+mews,data=df)
vif(lm13)
vif(summary(lm13))
library(car)
vif(lm12)
cor(df)
cor(lm12)
lm12<-lm(losdays2~bmi+bpsystolic+o2sat+temperature+heartrate+respirationrate+bpdiastolic+mews,data=df)
cor(lm12)
cor(lm11)
vif(lm11)
lm11<-lm(losdays2~bmi,data=df)
summary(lm11)
ggplot(df,aes(x = losdays2))+
geom_histogram()
ggplot(df,aes(x = log(losdays2)))+
geom_histogram()
df<-df %>%
mutate(log_los=log(losdays2))
lm1<-lm(log_los~factor(is30dayreadmit),data=df)
lm2<-lm(log_los~mews,data=df)
lm3<-lm(log_los~cindex,data=df)
lm4<-lm(log_los~evisit,data=df)
lm5<-lm(log_los~ageyear,data=df)
lm6<-lm(log_los~factor(gender),data=df)
lm7<-lm(log_los~factor(race),data=df) #not sig
lm8<-lm(log_los~factor(religion),data=df) #not sig
lm9<-lm(log_los~factor(maritalstatus),data=df) #not sig
lm10<-lm(log_los~factor(insurancetype),data=df) #not sig?
lm11<-lm(log_los~bmi,data=df) #not sig
summary(lm1)
summary(lm2)
summary(lm3)
summary(lm4)
summary(lm5)
summary(lm6)
summary(lm7)
summary(lm8)
summary(lm9)
summary(lm10)
summary(lm11)
?stepAIC
mult.fit <- lm(log_los ~ ., data=df)
step(mult.fit, direction='backward')
df$is30dayreadmit=as.factor(df$is30dayreadmit)
df$is30dayreadmit=as.factor(df$is30dayreadmit)
mult<-df %>%
select(log_los,mews,cindex,evisit,ageyear,bmi,is30dayreadmit)
mult.fit <- lm(log_los ~ ., data=mult)
step(mult.fit, direction='backward')
df$is30dayreadmit=as.factor(df$is30dayreadmit)
mult<-df %>%
select(log_los,mews,cindex,evisit,ageyear,bmi,is30dayreadmit)
View(df)
names(df)
mult<-select(df,log_los,mews,cindex,evisit,ageyear,bmi,is30dayreadmit)
rm(mult)
?select
mult<-select(df,df$log_los,df$mews,df$cindex,df$evisit,df$ageyear,df$bmi,df$is30dayreadmit)
mult<-select(.df,df$log_los,df$mews,df$cindex,df$evisit,df$ageyear,df$bmi,df$is30dayreadmit)
rm(list=ls())
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
filter(icu_flag==0) %>%
data.table()
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
#count number of visit and select ICU=0
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
filter(icu_flag==0) %>%
data.table()
#select first visit
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
df[df$temperature < 15] <- NA
df<-df %>%
mutate(log_los=log(losdays2))
df$is30dayreadmit=as.factor(df$is30dayreadmit)
mult<-select(.df,df$log_los,df$mews,df$cindex,df$evisit,df$ageyear,df$bmi,df$is30dayreadmit)
mult<-select(df$log_los,df$mews,df$cindex,df$evisit,df$ageyear,df$bmi,df$is30dayreadmit)
View(df)
df$is30dayreadmit=as.factor(df$is30dayreadmit)
mult.fit <- lm(log_los ~ mews+cindex+evisit+ageyear+bmi+is30dayreadmit ., data=df)
step(mult.fit, direction='backward')
mult.fit <- lm(log_los ~ mews+cindex+evisit+ageyear+bmi+is30dayreadmit ., data=df)
mult.fit <- lm(log_los ~ mews+cindex+evisit+ageyear+bmi+is30dayreadmit, data=df)
step(mult.fit, direction='backward')
best <- function(model, ...)
{
subsets <- regsubsets(formula(model), model.frame(model), ...)
subsets <- with(summary(subsets),
cbind(p = as.numeric(rownames(which)), which, rss, rsq, adjr2, cp, bic))
return(subsets)
}
# Select the 'best' 2 models of all subsets
round(best(mult.fit, nbest = 1), 4)
??regsubsets
library(leaps)
best <- function(model, ...)
{
subsets <- regsubsets(formula(model), model.frame(model), ...)
subsets <- with(summary(subsets),
cbind(p = as.numeric(rownames(which)), which, rss, rsq, adjr2, cp, bic))
return(subsets)
}
# Select the 'best' 2 models of all subsets
round(best(mult.fit, nbest = 1), 4)
<<<<<<< HEAD
=======
knitr::opts_chunk$set(echo = TRUE)
>>>>>>> af0a87b5584e8ccdf7bdaa2e7c17db530a4fa618
library(tidyverse)
library(janitor)
library(readxl)
library(data.table)
<<<<<<< HEAD
library(HH)
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
filter(icu_flag==0) %>%
data.table()
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
df[df$temperature < 15] <- NA
df<-df %>%
mutate(log_los=log(losdays2))
View(df)
df$mews[df$mews==0,1,2,3]<-"less"
df[df$mews==0,1,2,3]<-"less"
table(df)
summary(df)
lm12<-lm(log_los~mews+temperature+heartrate+respirationrate+bpdiastolic,data=df)
library(MASS)
vif(lm12)
library(car)
vif(lm12)
df[df$mews >5] <- "immediate action required"
df[df$mews =4 |df$mews =5] <-"further deterioration"
df[df$mews =2 |df$mews =3] <- "increase caution"
df[df$mews =0 |df$mews =1] <- "normal"
df[df$mews >5] <- "immediate action required"
df[df$mews ==4 |df$mews ==5] <-"further deterioration"
df[df$mews ==2 |df$mews ==3] <- "increase caution"
df[df$mews ==0 |df$mews ==1] <- "normal"
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
filter(icu_flag==0) %>%
data.table()
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
#change temperature lower than 15 to NA
df[df$temperature < 15] <- NA
df[df$temperature > 47] <- NA
df[df$bmi < 7] <-NA
df<-df %>%
mutate(log_los=log(losdays2))
df$is30dayreadmit=as.factor(df$is30dayreadmit)
df[df$mews >5] <- "immediate action required"
df[df$mews ==4 |df$mews ==5] <-"further deterioration"
df[df$mews ==2 |df$mews ==3] <- "increase caution"
df[df$mews ==0 |df$mews ==1] <- "normal"
df[df$mews ==4 ||df$mews ==5] <-"further deterioration"
df[df$mews >5] <- "immediate action required"
df[df$mews ==4 ||df$mews ==5] <-"further deterioration"
df[df$mews ==2 ||df$mews ==3] <- "increase caution"
df[df$mews ==0 ||df$mews ==1] <- "normal"
table
table(df$mews)
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
filter(icu_flag==0) %>%
data.table()
#select first visit
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
#change temperature lower than 15 to NA
df[df$temperature < 15] <- NA
df[df$temperature > 47] <- NA
df[df$bmi < 7] <-NA
df<-df %>%
mutate(log_los=log(losdays2))
df$is30dayreadmit=as.factor(df$is30dayreadmit)
df[df$mews >5] <- "immediate action required"
replace(df$mews, df$mews>5, "immediate action required")
df<-replace(df$mews, df$mews>5, "immediate action required")
df$mews<-replace(df$mews, df$mews>5, "immediate action required")
=======
>>>>>>> af0a87b5584e8ccdf7bdaa2e7c17db530a4fa618
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
#count number of visit and select ICU=0
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
filter(icu_flag==0) %>%
data.table()
#select first visit
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
#change temperature lower than 15 to NA
df[df$temperature < 15] <- NA
<<<<<<< HEAD
df[df$temperature > 47] <- NA
df[df$bmi < 7] <-NA
```
#transformation boxpox
```{r}
=======
>>>>>>> af0a87b5584e8ccdf7bdaa2e7c17db530a4fa618
ggplot(df,aes(x = losdays2))+
geom_histogram()
ggplot(df,aes(x = log(losdays2)))+
geom_histogram()
#use log of losdays2
df<-df %>%
mutate(log_los=log(losdays2))
<<<<<<< HEAD
df$mews<-replace(df$mews, df$mews>5, "immediate action required")
table(df$cindex)
df$is30dayreadmit=as.factor(df$is30dayreadmit)
df$mews<-replace(df$mews, df$mews>5, "immediate action required")
df$mews<-replace(df$mews, df$mews==4||df$mews==5, "further deterioration")
df$mews<-replace(df$mews, df$mews==2||df$mews==3, "increase caution")
df$mews<-replace(df$mews, df$mews==0||df$mews==1, "normal")
df$cindex<-replace(df$cindex, df$cindex==0,"normal")
df$cindex<-replace(df$cindex, df$cindex==1||df$cindex==2,"mild")
df$cindex<-replace(df$cindex, df$cindex==3||df$cindex==4,"moderate")
df$cindex<-replace(df$cindex, df$cindex>5,"severe")
lm2<-lm(log_los~mews,data=df)
lm2<-lm(log_los~factor(mews),data=df)
df$is30dayreadmit=as.factor(df$is30dayreadmit)
df$mews<-replace(df$mews, df$mews>5, "immediate action required")
df$mews<-replace(df$mews, df$mews==4||df$mews==5, "further deterioration")
df$mews<-replace(df$mews, df$mews==2||df$mews==3, "increase caution")
df$mews<-replace(df$mews, df$mews==0||df$mews==1, "normal")
df$cindex<-replace(df$cindex, df$cindex==0,"normal")
df$cindex<-replace(df$cindex, df$cindex==1||df$cindex==2,"mild")
df$cindex<-replace(df$cindex, df$cindex==3||df$cindex==4,"moderate")
df$cindex<-replace(df$cindex, df$cindex>4,"severe")
df$cindex<-replace(df$cindex, df$cindex==1||df$cindex==2,"mild")
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
#count number of visit and select ICU=0
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
filter(icu_flag==0) %>%
data.table()
#select first visit
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
#change temperature lower than 15 to NA
df[df$temperature < 15] <- NA
df[df$temperature > 47] <- NA
df[df$bmi < 7] <-NA
```
#transformation boxpox
```{r}
ggplot(df,aes(x = losdays2))+
geom_histogram()
ggplot(df,aes(x = log(losdays2)))+
geom_histogram()
#use log of losdays2
df<-df %>%
mutate(log_los=log(losdays2))
df$mews<-replace(df$mews, df$mews>5, "immediate action required")
df$mews<-replace(df$mews, df$mews==4||df$mews==5, "further deterioration")
df$mews<-replace(df$mews, df$mews==4|df$mews==5, "further deterioration")
df$mews<-replace(df$mews, df$mews==2|df$mews==3, "increase caution")
df$mews<-replace(df$mews, df$mews==0|df$mews==1, "normal")
df$cindex<-replace(df$cindex, df$cindex==0,"normal")
df$cindex<-replace(df$cindex, df$cindex==1|df$cindex==2,"mild")
df$cindex<-replace(df$cindex, df$cindex==3|df$cindex==4,"moderate")
df$cindex<-replace(df$cindex, df$cindex>4,"severe")
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
#count number of visit and select ICU=0
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
filter(icu_flag==0) %>%
data.table()
#select first visit
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
#change temperature lower than 15 to NA
df[df$temperature < 15] <- NA
df[df$temperature > 47] <- NA
df[df$bmi < 7] <-NA
```
#transformation boxpox
```{r}
ggplot(df,aes(x = losdays2))+
geom_histogram()
ggplot(df,aes(x = log(losdays2)))+
geom_histogram()
#use log of losdays2
df<-df %>%
mutate(log_los=log(losdays2))
df$is30dayreadmit=as.factor(df$is30dayreadmit)
df$mews<-replace(df$mews, df$mews>5, "immediate action required")
df$mews<-replace(df$mews, df$mews==4|df$mews==5, "further deterioration")
df$mews<-replace(df$mews, df$mews==2|df$mews==3, "increase caution")
df$mews<-replace(df$mews, df$mews==0|df$mews==1, "normal")
df$cindex<-replace(df$cindex, df$cindex==0,"normal")
df$cindex<-replace(df$cindex, df$cindex==1|df$cindex==2,"mild")
df$cindex<-replace(df$cindex, df$cindex==3|df$cindex==4,"moderate")
df$cindex<-replace(df$cindex, df$cindex==5,"severe")
table(df$mewa)
table(df$mews)
table(df$cindex)
df<-df %>%
mutate(log_los=log(losdays2)) %>%
select(-n)
df<-df%>%
select(-n)
??select
df<-df%>%
dplyr::select(-n)
df<-df%>%
select(-patientid,-visitid,-loshours,-admitdtm,-icu_flag,-postalcode,-facilityname,-facilityzip,-losdays2)
df<-df%>%
dplyr::select(-patientid,-visitid,-loshours,-admitdtm,-icu_flag,-postalcode,-facilityname,-facilityzip,-losdays2)
df$is30dayreadmit=as.character(df$is30dayreadmit)
write.csv(df,file="losdays")
write_csv(df,file="losdays")
?write.csv
write.table(df,file="losdays")
write.table(df,file="losdays")
write.table(df,file="losdays.csv")
write.csv(df,file="losdays.csv")
=======
lm1<-lm(log_los~factor(is30dayreadmit),data=df)
lm2<-lm(log_los~mews,data=df)
lm3<-lm(log_los~cindex,data=df)
lm4<-lm(log_los~evisit,data=df)
lm5<-lm(log_los~ageyear,data=df)
lm6<-lm(log_los~factor(gender),data=df) # not sig
lm7<-lm(log_los~factor(race),data=df) #not sig
lm8<-lm(log_los~factor(religion),data=df) #not sig
lm9<-lm(log_los~factor(maritalstatus),data=df) #not sig
lm10<-lm(log_los~factor(insurancetype),data=df) #not sig?
lm11<-lm(log_los~bmi,data=df)
df$is30dayreadmit=as.factor(df$is30dayreadmit)
mult.fit <- lm(log_los ~ mews+cindex+evisit+ageyear+bmi+is30dayreadmit, data=df)
step(mult.fit, direction='backward')
#select
best <- function(model, ...)
{
subsets <- regsubsets(formula(model), model.frame(model), ...)
subsets <- with(summary(subsets),
cbind(p = as.numeric(rownames(which)), which, rss, rsq, adjr2, cp, bic))
return(subsets)
}
# Select the 'best' 2 models of all subsets
round(best(mult.fit, nbest = 1), 4)
>>>>>>> af0a87b5584e8ccdf7bdaa2e7c17db530a4fa618
library(tidyverse)
library(janitor)
library(readxl)
library(data.table)
library(HH)
library(leaps)
library(car)
GH_data <- read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
#count number of visit and select ICU=0
mul <- count(df)
GH_data_noICU <- left_join(GH_data,mul,by = "patientid") %>%
filter(icu_flag == 0) %>%
data.table()
GH_data <- read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
mul <- count(df)
GH_data_noICU <- left_join(GH_data,mul,by = "patientid") %>%
filter(icu_flag == 0) %>%
data.table()
View(GH_data)
mul <- count(GH_data)
GH_data_noICU <- left_join(GH_data,mul,by = "patientid") %>%
filter(icu_flag == 0) %>%
data.table()
setkey(GH_data_noICU, patientid)
df <- GH_data_noICU[J(unique(GH_data_noICU)), mult = "first"]
#
df$is30dayreadmit=as.character(df$is30dayreadmit)
df_check <-
df %>%
as.tibble() %>%
dplyr::select(-c(loshours, admitdtm, icu_flag, postalcode, facilityname, facilityzip)) %>%
rename(num_visit = n)
category_check_list <-
df_check %>%
dplyr::select(is30dayreadmit, evisit, mews, cindex, gender, race, religion, maritalstatus, insurancetype) %>%
apply(2, table)
names(category_check_list) <- c("is30dayreadmit", "evisit", "mews", "cindex", "gender", "race", "religion", "maritalstatus", "insurancetype")
#the summary data of potential continous predictors
df_check %>%
dplyr::select(-c(is30dayreadmit, evisit, mews, cindex, gender, race,
religion, maritalstatus, insurancetype)) %>%
dplyr::select(-c(patientid, visitid, losdays2, num_visit)) %>%
gather(key = continuous_variable, value = value, ageyear:bpdiastolic) %>%
group_by(continuous_variable) %>%
summarise(min = min(value, na.rm = T),
mean = mean(value, na.rm = T),
median = median(value, na.rm = T),
max = max(value, na.rm = T))
table(GH_data)
category_check_list$mews
category_check_list$cindex
category_check_list$race
category_check_list$maritalstatus
df$race<-replace(df$race, df$mews=="Hawaii/Pacf Isl", "Other/Multiracial")
df$maritalstatus<-replace(df$maritalstatus, df$martitalstatus=="Civil Union", " Married")

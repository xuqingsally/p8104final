knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(readxl)
df<-read_excel("GHProject_Dataset.xlsx")
View(df)
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names()
summary(df)
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patient_id)
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
count(df)
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid) %>%
filter(count(.)>1)
mul<-count(df)%>%
filter(n>1)
View(mul)
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid) %>%
mutate(time_visit=count(df))
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid) %>%
mutate(time_visit=count(df)$n)
mul$n
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid) %>%
mutate(time_visit=count(df)[,2])
?left_join
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
mul<-count(df)
df<-left_join(df,mul,by = "patientid")
setkey(df, patientid)
df[J(unique(patientid)), mult = "first"]
?setkey
??setkey
install.packages("data.table")
library(data.table)
setkey(df, patientid)
df[J(unique(patientid)), mult = "first"]
df<-data.table(df)
setkey(df, patientid)
df[J(unique(patientid)), mult = "first"]
df<-data.table(df)
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
filter(n>1)
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
mul<-count(df)
df<-left_join(df,mul,by = "patientid")
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
#count number of visit
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
data.table(df)
#select first visit
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
data.table(df)
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
#count number of visit
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
data.table()
#select first visit
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
names(df)
df<-df[J(unique(patientid)), mult = "first"] %>%
select(-loshours,-admitdtm,-postalcode,-facilityname,-facilityzip,-n)
plot(df)
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
#count number of visit
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
data.table()
#select first visit
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
table(df$gender)
table(df$race)
table(df$religion)
table(df$maritalstatus)
table(df$insurancetype)
summary(df)
tem<-df %>%
filter(temperature<35)
View(tem)
tem<-df %>%
replace(temperature<15, NA)
tem<-df %>%
replace(df$temperature<15, NA)
df[df$temperature < 15] <- NA
summary(df)
filter(df$respirationrate>50)
filter(df,df$respirationrate>50)
names(df)
lm<-(losday2~factor(is30dayreadmit),data=df)
lm<-(losday2~mews,data=df)
lm<-(losday2~mews,data=df)
library(MASS)
lm<-(losday2~mews,data=df)
lm<-(df$losday2~df$mews)
summary(lm)
lm<-lm(losday2~mews,data=df)
summary(lm)
lm(losday2~mews,data=df)
names(df)
lm<-lm(losdays2~mews,data=df)
summary(lm)
lm(losdays2~mews,data=df)
lm1<-lm(losdays2~factor(is30dayreadmit),data=df)
lm2<-lm(losdays2~mews,data=df)
lm3<-lm(losdays2~cindex,data=df)
lm4<-lm(losdays2~evisit,data=df)
lm5<-lm(losdays2~ageyear,data=df)
lm6<-lm(losdays2~factor(gender),data=df)
lm7<-lm(losdays2~factor(race),data=df)
lm8<-lm(losdays2~factor(religion),data=df)
lm9<-lm(losdays2~factor(maritalstatus),data=df)
lm10<-lm(losdays2~factor(insurancetype),data=df)
summary(lm1)
summary(lm2)
summary(lm3)
summary(lm4)
summary(lm5)
summary(lm6)
summary(lm7)
summary(lm8)
summary(lm9)
summary(lm10)
lm11<-lm(losdays2~bmi+bpsystolic+o2sat+temperature+heartrate+respirationrate+bpdiastolic,data=df)
summary(lm11)
lm12<-lm(losdays2~bmi+bpsystolic+o2sat+temperature+heartrate+respirationrate+bpdiastolic+mews,data=df)
summary(lm12)
vif(lm12)
library(MASS)
vif(lm12)
??vif
install.packages("HH")
library(HH)
vif(lm12)
vif(lm11)
lm13<-lm(losdays2~bmi+mews,data=df)
vif(lm13)
vif(summary(lm13))
library(car)
vif(lm12)
cor(df)
cor(lm12)
lm12<-lm(losdays2~bmi+bpsystolic+o2sat+temperature+heartrate+respirationrate+bpdiastolic+mews,data=df)
cor(lm12)
cor(lm11)
vif(lm11)
lm11<-lm(losdays2~bmi,data=df)
summary(lm11)
ggplot(df,aes(x = losdays2))+
geom_histogram()
ggplot(df,aes(x = log(losdays2)))+
geom_histogram()
df<-df %>%
mutate(log_los=log(losdays2))
lm1<-lm(log_los~factor(is30dayreadmit),data=df)
lm2<-lm(log_los~mews,data=df)
lm3<-lm(log_los~cindex,data=df)
lm4<-lm(log_los~evisit,data=df)
lm5<-lm(log_los~ageyear,data=df)
lm6<-lm(log_los~factor(gender),data=df)
lm7<-lm(log_los~factor(race),data=df) #not sig
lm8<-lm(log_los~factor(religion),data=df) #not sig
lm9<-lm(log_los~factor(maritalstatus),data=df) #not sig
lm10<-lm(log_los~factor(insurancetype),data=df) #not sig?
lm11<-lm(log_los~bmi,data=df) #not sig
summary(lm1)
summary(lm2)
summary(lm3)
summary(lm4)
summary(lm5)
summary(lm6)
summary(lm7)
summary(lm8)
summary(lm9)
summary(lm10)
summary(lm11)
?stepAIC
mult.fit <- lm(log_los ~ ., data=df)
step(mult.fit, direction='backward')
df$is30dayreadmit=as.factor(df$is30dayreadmit)
df$is30dayreadmit=as.factor(df$is30dayreadmit)
mult<-df %>%
select(log_los,mews,cindex,evisit,ageyear,bmi,is30dayreadmit)
mult.fit <- lm(log_los ~ ., data=mult)
step(mult.fit, direction='backward')
df$is30dayreadmit=as.factor(df$is30dayreadmit)
mult<-df %>%
select(log_los,mews,cindex,evisit,ageyear,bmi,is30dayreadmit)
View(df)
names(df)
mult<-select(df,log_los,mews,cindex,evisit,ageyear,bmi,is30dayreadmit)
rm(mult)
?select
mult<-select(df,df$log_los,df$mews,df$cindex,df$evisit,df$ageyear,df$bmi,df$is30dayreadmit)
mult<-select(.df,df$log_los,df$mews,df$cindex,df$evisit,df$ageyear,df$bmi,df$is30dayreadmit)
rm(list=ls())
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
filter(icu_flag==0) %>%
data.table()
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
df<-read_excel("GHProject_Dataset.xlsx") %>%
clean_names() %>%
group_by(patientid)
#count number of visit and select ICU=0
mul<-count(df)
df<-left_join(df,mul,by = "patientid") %>%
filter(icu_flag==0) %>%
data.table()
#select first visit
setkey(df, patientid)
df<-df[J(unique(patientid)), mult = "first"]
df[df$temperature < 15] <- NA
df<-df %>%
mutate(log_los=log(losdays2))
df$is30dayreadmit=as.factor(df$is30dayreadmit)
mult<-select(.df,df$log_los,df$mews,df$cindex,df$evisit,df$ageyear,df$bmi,df$is30dayreadmit)
mult<-select(df$log_los,df$mews,df$cindex,df$evisit,df$ageyear,df$bmi,df$is30dayreadmit)
View(df)
df$is30dayreadmit=as.factor(df$is30dayreadmit)
mult.fit <- lm(log_los ~ mews+cindex+evisit+ageyear+bmi+is30dayreadmit ., data=df)
step(mult.fit, direction='backward')
mult.fit <- lm(log_los ~ mews+cindex+evisit+ageyear+bmi+is30dayreadmit ., data=df)
mult.fit <- lm(log_los ~ mews+cindex+evisit+ageyear+bmi+is30dayreadmit, data=df)
step(mult.fit, direction='backward')
best <- function(model, ...)
{
subsets <- regsubsets(formula(model), model.frame(model), ...)
subsets <- with(summary(subsets),
cbind(p = as.numeric(rownames(which)), which, rss, rsq, adjr2, cp, bic))
return(subsets)
}
# Select the 'best' 2 models of all subsets
round(best(mult.fit, nbest = 1), 4)
??regsubsets
library(leaps)
best <- function(model, ...)
{
subsets <- regsubsets(formula(model), model.frame(model), ...)
subsets <- with(summary(subsets),
cbind(p = as.numeric(rownames(which)), which, rss, rsq, adjr2, cp, bic))
return(subsets)
}
# Select the 'best' 2 models of all subsets
round(best(mult.fit, nbest = 1), 4)
